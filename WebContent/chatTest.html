<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>



</head>
<body>

<button onclick="subOpen();">建立链接</button>
<div>
	getter:<input id="getter" value="1">
	sender:<input id="sender" value="2">
</div>
<input id="msg">
<button onclick="sendMsg()">发送数据</button>
<div id="session"></div>

<script type="text/javascript">

var ws;
var getter = document.getElementById("getter");
var sender = document.getElementById("sender");

function subOpen(){
	var target = "ws://li2453671898.yicp.io/C2CTest/chatSocket/"+sender.value;
	console.log(target);
	 if ('WebSocket' in window) {
         ws = new WebSocket(target);
     } else if ('MozWebSocket' in window) {
         ws = new MozWebSocket(target);
     } else {
         alert('WebSocket is not supported by this browser.');
         return;
     }

	 ws.onmessage = function(event){
	 	console.info(event.data);
	 	document.getElementById("session").innerHTML += getter.value +":"+event.data+"<br/>";
	 }
}

function sendMsg(){
	var message = document.getElementById("msg");
	var msg = {
		'getter':getter.value,
		'sender':sender.value,
		'message':message.value
	}
	ws.send(JSON.stringify(msg));
	document.getElementById("session").innerHTML += "我:"+message.value+"<br/>";
	message.val = "";
}


</script>
</body>
</html>